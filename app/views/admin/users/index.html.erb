<div class="card bg-base-100 shadow-xl">
  <div class="card-body">
    <div class="flex justify-between items-center mb-6">
      <h1 class="card-title text-3xl"><%= t("admin.users.index.title") %></h1>
      <div class="text-sm text-base-content/70">
        <%= t("admin.users.index.total_users", count: User.count) %>
      </div>
    </div>

    <!-- Search and Filter Form -->
    <%= form_with url: admin_users_path, method: :get, local: true, class: "mb-6 space-y-4" do |form| %>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="form-control">
          <label class="label">
            <span class="label-text"><%= t("admin.users.index.search") %></span>
          </label>
          <%= form.text_field :search, value: params[:search], placeholder: t("admin.users.index.search_placeholder"), class: "input input-bordered w-full" %>
        </div>

        <div class="form-control">
          <label class="label">
            <span class="label-text"><%= t("admin.users.index.filter_by_role") %></span>
          </label>
          <%= form.select :role, options_for_select([
            [t("admin.users.index.all_roles"), ""],
            [t("admin.users.index.role_user"), "user"],
            [t("admin.users.index.role_admin"), "admin"]
          ], params[:role]), {}, { class: "select select-bordered w-full" } %>
        </div>
      </div>

      <div class="flex gap-2">
        <%= form.submit t("admin.users.index.filter"), class: "btn btn-primary" %>
        <% if params[:search].present? || params[:role].present? %>
          <%= link_to t("admin.users.index.clear"), admin_users_path, class: "btn btn-outline" %>
        <% end %>
      </div>
    <% end %>

    <!-- Users Table -->
    <div class="overflow-x-auto">
      <table class="table table-zebra w-full">
        <thead>
          <tr>
            <th><%= t("admin.users.index.username") %></th>
            <th><%= t("admin.users.index.email") %></th>
            <th><%= t("admin.users.index.role") %></th>
            <th><%= t("admin.users.index.verified") %></th>
            <th><%= t("admin.users.index.created_at") %></th>
            <th class="text-right"><%= t("admin.users.index.actions") %></th>
          </tr>
        </thead>
        <tbody>
          <% if @users.any? %>
            <% @users.each do |user| %>
              <tr>
                <td>
                  <div class="flex items-center gap-2">
                    <% if user.avatar.attached? %>
                      <%= image_tag user.avatar, class: "w-8 h-8 rounded-full object-cover" %>
                    <% else %>
                      <div class="w-8 h-8 rounded-full bg-base-300 flex items-center justify-center text-sm font-semibold">
                        <%= user.username.first.upcase %>
                      </div>
                    <% end %>
                    <%= link_to user.username, admin_user_path(user), class: "link link-primary font-semibold" %>
                  </div>
                </td>
                <td><%= user.email %></td>
                <td>
                  <span class="badge <%= user.admin? ? 'badge-warning' : 'badge-info' %>">
                    <%= user.role.humanize %>
                  </span>
                </td>
                <td>
                  <% if user.verified? %>
                    <span class="badge badge-success"><%= t("admin.users.index.verified_yes") %></span>
                  <% else %>
                    <span class="badge badge-error"><%= t("admin.users.index.verified_no") %></span>
                  <% end %>
                </td>
                <td><%= user.created_at.strftime("%B %d, %Y") %></td>
                <td class="text-right">
                  <div class="flex justify-end gap-2">
                    <%= link_to t("admin.users.index.view"), admin_user_path(user), class: "btn btn-sm btn-ghost" %>
                    <%= link_to t("admin.users.index.edit"), edit_admin_user_path(user), class: "btn btn-sm btn-primary" %>
                    <% if user == Current.user %>
                      <button class="btn btn-sm btn-error" disabled aria-label="<%= t("admin.users.index.cannot_delete_self_tooltip") %>">
                        <%= t("admin.users.index.delete") %>
                      </button>
                    <% else %>
                      <%= button_to t("admin.users.index.delete"), admin_user_path(user), method: :delete, 
                          data: { turbo_confirm: t("admin.users.index.confirm_delete", username: user.username) },
                          class: "btn btn-sm btn-error" %>
                    <% end %>
                  </div>
                </td>
              </tr>
            <% end %>
          <% else %>
            <tr>
              <td colspan="6" class="text-center py-8 text-base-content/70">
                <%= t("admin.users.index.no_users_found") %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <% if @users.respond_to?(:current_page) && @users.total_pages > 1 %>
      <div class="mt-6 flex justify-center">
        <%= paginate @users %>
      </div>
    <% end %>
  </div>
</div>

